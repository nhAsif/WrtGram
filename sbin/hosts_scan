#!/bin/sh

mkdir -p /usr/lib/wrtgram/arps &>/dev/null

(while [ true ] 
do

	for line in $(cat /proc/net/arp | grep "192.168.250"); do
		IP=$(echo "$line" | awk '{print $1}')
		MAC=$(echo "$line" | awk '{print $4}')
		LAST="NULL"
		ping $IP -w 1 -q &>/dev/null
		[ $? == 0 ]  && RESULT="UP" || RESULT="DOWN"
		if [ -e /usr/lib/wrtgram/arps/$IP ]; then
			LAST=$(cat /usr/lib/wrtgram/arps/$IP)
		fi
		if [ "${LAST}" != "${RESULT}" ];then
			name=$(cat /tmp/dhcp.leases | grep " ${IP} " | awk '{print $4}')
			[ "${name}" == "" ] && name=$(cat /tmp/hosts/dhcp.cfg01411c | grep "^${IP}" | awk '{print $2}')
			date=$(date "+%d/%m/%Y %I:%M %p")
			telegram=$(echo -e "ðŸ“± *Device:* ${name}\nðŸ“… *Data:* ${date}\nðŸŒ *IP:* ${IP}\nðŸ”¢ *MAC:* ${MAC}\nðŸ“¶ *State:* ${RESULT}")
			/sbin/telebot "$telegram"
		fi
		echo -en "${RESULT}" > /usr/lib/wrtgram/arps/$IP
	done 
	sleep 300
done)&
